---
alwaysApply: true
---

# Code Conventions

## Language: Documentation and Comments

**Always use English** in:

- **README** and any project documentation (docs, ADRs, etc.).
- **Code comments**: inline comments, `//` blocks and JSDoc.

English is the standard language for comments and documentation, so the code is accessible and maintainable by international teams and collaborators.

## File Naming

### Domain Entities
- **Format**: `*.entity.ts`
- **Location**: `src/domain/entities/`
- **Examples**: 
  - `user.entity.ts`
  - `appointment.entity.ts`
  - `availability.entity.ts`

### Value Objects
- **Format**: `*.vo.ts`
- **Location**: `src/domain/value-objects/`
- **Examples**:
  - `email.vo.ts`
  - `datetime.vo.ts`
  - `role.vo.ts`

### Repositories (Interfaces)
- **Format**: `*.repository.ts`
- **Location**: `src/domain/repositories/`
- **Examples**:
  - `user.repository.ts`
  - `appointment.repository.ts`
- **Note**: Interfaces only, never implementations

### Repositories (Implementations)
- **Format**: `drizzle-*.repository.ts`
- **Location**: `src/infrastructure/database/repositories/`
- **Examples**:
  - `drizzle-user.repository.ts`
  - `drizzle-appointment.repository.ts`

### Use Cases
- **Format**: `*-usecase.ts` or `*-use-case.ts`
- **Location**: `src/application/use-cases/`
- **Examples**:
  - `create-user.usecase.ts`
  - `create-appointment.usecase.ts`
  - `login-user.usecase.ts`

### HTTP Controllers
- **Format**: `*.controller.ts`
- **Location**: `src/interfaces/http/controllers/`
- **Examples**:
  - `auth.controller.ts`
  - `appointment.controller.ts`
  - `professional.controller.ts`

### Guards
- **Format**: `*.guard.ts`
- **Location**: `src/interfaces/http/guards/`
- **Examples**:
  - `jwt-auth.guard.ts`

### Strategies (Strategy Pattern)
- **Format**: `*.strategy.ts`
- **Location**: `src/infrastructure/notifications/`
- **Examples**:
  - `email.strategy.ts`
  - `sms.strategy.ts`
  - `push.strategy.ts`

### Mappers
- **Format**: `*.mapper.ts`
- **Location**: `src/interfaces/http/mappers/`
- **Examples**:
  - `appointment.mapper.ts`

### DTOs
- **Format**: `*.dto.ts`
- **Location**: 
  - Internal DTOs: `src/application/dtos/`
  - HTTP DTOs: `src/interfaces/http/dto/` (if exists)

### Service Interfaces
- **Format**: `*.interface.ts` or `*-strategy.interface.ts`
- **Location**: `src/domain/services/`
- **Examples**:
  - `notification-strategy.interface.ts`

### Infrastructure Services
- **Format**: `*.service.ts`
- **Location**: According to type:
  - `src/infrastructure/calendar/` (e.g: `google-calendar.service.ts`)
  - `src/infrastructure/notifications/` (for factories)

## Class Naming

### Entity Classes
```typescript
// PascalCase, singular
export class User { }
export class Appointment { }
```

### Use Cases
```typescript
// PascalCase, verb + noun + UseCase
export class CreateUserUseCase { }
export class LoginUserUseCase { }
```

### Repositories
```typescript
// Interfaces: PascalCase + Repository
export interface UserRepository { }

// Implementations: Drizzle + PascalCase + Repository
export class DrizzleUserRepository implements UserRepository { }
```

### Controllers
```typescript
// PascalCase + Controller
export class AppointmentController { }
```

### Strategies
```typescript
// PascalCase + Strategy
export class EmailStrategy implements NotificationStrategy { }
```

## Class Structure

### Use TypeScript with Explicit Types

**✅ GOOD**:
```typescript
export class User {
  constructor(
    private readonly id: string,
    private readonly email: string,
    private readonly role: Role
  ) {}
}
```

**❌ BAD**:
```typescript
export class User {
  constructor(
    private readonly id: any, // ❌ any
    private readonly email, // ❌ no type
    private readonly role
  ) {}
}
```

### Avoid `any`

- ❌ DO NOT use `any` except in exceptional justified cases
- ✅ Use specific types or `unknown` if type is unknown
- ✅ Type all parameters and returns

### Documentation with JSDoc

**Use JSDoc when**:
- Code intention is not obvious
- Parameters need explanation
- Complex methods require context

**✅ GOOD**:
```typescript
/**
 * Checks whether a time slot is available for an appointment.
 *
 * @param professionalId - Professional ID
 * @param dateTime - Date and time to validate
 * @returns true if available, false if occupied
 */
async isAvailable(professionalId: string, dateTime: DateTime): Promise<boolean> {
  // ...
}
```

## Error Handling

### Domain Exceptions

For business errors, create specific exceptions in the domain:

```typescript
// domain/exceptions/appointment-not-available.exception.ts
export class AppointmentNotAvailableException extends Error {
  constructor(dateTime: DateTime) {
    super(`Appointment not available at ${dateTime}`);
  }
}
```

### HTTP Exceptions

For HTTP responses, use NestJS exceptions:

```typescript
// In controllers or use cases that handle HTTP
throw new BadRequestException('Invalid input');
throw new NotFoundException('User not found');
```

### DO NOT Leak Sensitive Information

**❌ BAD**:
```typescript
throw new Error(`Password incorrect for user ${userId}`); // Exposes ID
```

**✅ GOOD**:
```typescript
throw new UnauthorizedException('Invalid credentials');
```

## Imports

### Import Order

1. External libraries (NestJS, Drizzle ORM, etc.)
2. Relative imports from other layers
3. Relative imports from same layer
4. Types (with `type` when it's only a type)

**Example**:
```typescript
// 1. External
import { Injectable } from '@nestjs/common';

// 2. Other layers
import { UserRepository } from '../../../domain/repositories/user.repository';
import { CreateUserUseCase } from '../../use-cases/create-user.usecase';

// 3. Same layer
import { UserMapper } from '../mappers/user.mapper';

// 4. Types
import type { CreateUserDto } from '../../../application/dtos/create-user.dto';
```

### Avoid Circular Imports

- ❌ DO NOT create circular dependencies between modules
- ✅ If detected, refactor the structure

## Code Format

### Prettier

The project uses Prettier for formatting. Run before commit:
```bash
npm run format
```

### Indentation
- Use 2 spaces (configured in Prettier)

### Quotes
- Prefer single quotes for strings (configured in Prettier)

## Variable and Function Names

### Variables
- **camelCase**: `userId`, `appointmentDate`, `isAvailable`

### Functions/Methods
- **camelCase**: `getUserById()`, `createAppointment()`, `validateAvailability()`

### Constants
- **SCREAMING_SNAKE_CASE**: `MAX_APPOINTMENT_DURATION`, `DEFAULT_TIMEZONE`

### Private/Protected
- Use `private` or `protected` as appropriate
- Prefix `private readonly` for injected dependencies

## Conventions Checklist

Before commit:
- ✅ Do file names follow conventions?
- ✅ Do class names follow PascalCase?
- ✅ Do variables and functions follow camelCase?
- ✅ Are all parameters typed?
- ✅ No use of `any`?
- ✅ Is code formatted with Prettier?
